# TDD Command

このCommandは **tdd-guide** エージェントを呼び出し、テスト駆動開発（TDD）のメソドロジーを強制的に実行させます。

## このCommandの機能

1. **インターフェースのスケルトン作成** - 最初に型やインターフェースを定義します。
2. **テストを先に生成** - 失敗するテストを記述します（RED）。
3. **最小限のコード実装** - テストをパスするのに必要最低限のコードを記述します（GREEN）。
4. **リファクタリング** - テストが成功した状態を維持しながらコードを改善します（REFACTOR）。
5. **カバレッジの検証** - テストカバレッジが 80% 以上であることを確認します。

## 使用するタイミング

以下のような状況で `/tdd` を使用してください：

- 新機能を実装するとき
- 新しい関数やコンポーネントを追加するとき
- バグを修正するとき（まずバグを再現するテストを記述します）
- 既存のコードをリファクタリングするとき
- 重要なビジネスロジックを構築するとき

## 動作の仕組み

tdd-guide エージェントは以下の手順を踏みます：

1. 入出力のための**インターフェースを定義**します。
2. **失敗するテストを記述**します（コードがまだ存在しないため）。
3. **テストを実行**し、正しい理由で失敗することを確認します。
4. テストをパスさせるための**最小限の実装**を記述します。
5. **テストを実行**し、パスすることを確認します。
6. テストの合格を維持したまま、コードを**リファクタリング**します。
7. **カバレッジをチェック**し、80% 未満の場合はテストを追加します。

## TDD サイクル

```
RED → GREEN → REFACTOR → REPEAT

RED:      失敗するテストを書く
GREEN:    パスさせるための最小限のコードを書く
REFACTOR: テスト合格を維持しつつ、コードを改善する
REPEAT:   次の機能やシナリオへ進む

```

## TDD ベストプラクティス

**やるべきこと（DO）：**

- ✅ 実装の前に必ずテストを書く
- ✅ 実装前にテストを実行し、失敗することを確認する
- ✅ テストをパスさせるための最小限のコードを書く
- ✅ テストがパスした後でのみリファクタリングを行う
- ✅ エッジケースやエラーシナリオを追加する
- ✅ カバレッジ 80% 以上を目指す（重要なコードは 100%）

**やってはいけないこと（DON'T）：**

- ❌ テストの前に実装を書く
- ❌ 変更のたびにテストを実行するのをスキップする
- ❌ 一度に大量のコードを書く
- ❌ 失敗したテストを無視する
- ❌ 実装の詳細をテストする（振る舞いをテストすべき）
- ❌ すべてをモックにする（結合テストも優先する）

## カバレッジ要件

- **すべてのコードで最低 80%**
- **以下のタイプについては 100% 必須：**
- 金銭的な計算
- バリデーション（検証）ロジック
- セキュリティに関連する重要なコード
- コアとなるビジネスロジック

## 重要事項

**強制ルール**：テストは必ず実装の前に記述されなければなりません。TDD サイクルは以下の通りです：

1. **RED** - 失敗するテストを書く
2. **GREEN** - パスするように実装する
3. **REFACTOR** - コードを改善する

RED フェーズを飛ばすことは決して許されません。テストの前にコードを書くことも厳禁です。

## 他のCommandとの連携

- 最初に `/plan` を使用して構築内容を理解する
- `/tdd` を使用してテストと共に実装する
- ビルドエラーが発生した場合は `/build-fix` を使用
- `/code-review` で実装をレビュー
- `/test-coverage` でカバレッジを検証

## 関連エージェント

このCommandは以下の場所にある `tdd-guide` エージェントを呼び出します：
`~/.claude/agents/tdd-guide.md`

また、以下の場所にある `tdd-workflow` スキルを参考にします：
`~/.claude/skills/tdd-workflow/`
