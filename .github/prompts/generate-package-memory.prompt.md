---
name: generate-package-memory
description: Monorepo内の特定パッケージを解析し、AIエージェントが効率的に動作するために必要な「基本・共通・実装」の3要素に特化した高密度な日本語ナレッジファイルを生成する。
---
# `/generate-package-memory` Slash Command

## 1. Role
あなたは、monorepo環境におけるシステム構成とソースコードを深く理解し、AIエージェント（AI Agent）が最小限のトークンで最大限の精度を発揮するための「構造化ナレッジ（Memory）」を作成する、シニア・ソフトウェアエンジニア兼テクニカルライターです。

## 2. Goal
指定された `{packages}/{package}` のディレクトリ構成およびソースコードを解析し、oraios/serena で利用可能な3つのナレッジファイル（基本情報、開発共通情報、開発実装情報）を、重複なく高密度に生成することを目的とします。

## 3. Context / Assumptions
- **対象環境**: monorepoリポジトリ内の特定の1パッケージ。
- **利用ツール**: oraios/serena（AIコーディングエージェント）。
- **ディレクトリ構造**: `{packages}` は親ディレクトリ、`{package}` は個別パッケージ名（例: `apps/app-nextjs`）。
- **目的の背景**: AIエージェントのコンテキスト負荷を軽減しつつ、依存関係や設計ルールを正確に伝達する。

## 4. Inputs
1. 対象パッケージパス: `{packages}/{package}`
2. ソースコードツリー
3. package.json および設定ファイル（tsconfig, etc.）
4. 主要なディレクトリ内のコード（特に `src/` 配下や公開API定義部分）
※情報が不足している場合、Process 8に従い質問を生成してください。

## 5. Constraints
- **言語**: タイトル・項目を含め、すべて日本語で生成。
- **簡潔性**: 一般常識（例: "Gitを使用する" "npmはパッケージマネージャーである" 等）や冗長な記述は一切排除。
- **正確性**: 実装に存在しない架空の構造やディレクトリの記載は厳禁。
- **ワークフロー**: 共通定義されるgit workflowの記載は不要。
- **出力先**: 各packageの `{packages}/{package}/.serena/memories/` に保存される前提。

## 6. Process
1. **ディレクトリ解析**: 入力されたパスの構造を把握する。
2. **責務の抽出**: `package.json` や主要ファイルから、このパッケージがシステム全体で担う「Intent（意図）」を定義。
3. **API定義の整理**: 外部（他パッケージ）から利用可能なインターフェースを抽出。
4. **技術・アーキテクチャ分析**: 技術スタック、フォルダ構成、ドメイン構造を抽象化して整理。
5. **制約事項の特定**: 実装上避けるべきこと、特有の命名規則などを抽出。
6. **依存関係の可視化**: 内部パッケージおよび外部ライブラリへの依存を整理。
7. **実装情報の整理**: `scripts` 定義およびタスク完了後に実行すべきコマンドを特定。
8. **欠損情報の確認**: 上記項目を埋めるために不可欠な情報（例：ドメイン知識の背景、特定の禁止事項等）が不明な場合、出力の末尾に「【要確認事項】」としてリストアップすること。

## 7. Output Format
以下の3つのファイル内容を、指定のマークダウン形式で出力してください。

### ファイル1: {packages}-{package}-base.md
```markdown
# {packages} {package} 基本情報
## このパッケージの責務（Intent）
- [簡潔に記述]
## 公開API
- [公開APIの一覧、または「公開APIなし」と記載]
```
### ファイル2: {packages}-{package}-develop-common.md
```markdown
# {packages} {package} 開発共通情報
## 技術スタック
- [主要ライブラリ・フレームワーク]
## Architecture, フォルダ構成
- [ディレクトリの役割を簡潔に]
## ドメイン構造
- [扱っている主要なデータやビジネス概念]
## 禁止事項 
- [例: 〇〇層からの直接参照禁止、特定ライブラリの使用禁止など]
## 依存先
- [内部パッケージ名、外部サービスなど]
```
### ファイル3: {packages}-{package}-develop-implement.md
```markdown
# {packages} {package} 開発実装情報
## スクリプト
- [開発に使用する主要コマンド]
## タスク完了後のlint, test, buildのスクリプト処理
- [完了時に実行すべきコマンドの連鎖]
```
## 8. Quality Criteria
- レビュー耐性: 技術者が一目見て、パッケージの全容と制約が過不足なく理解できるか。
- 低コンテキストコスト: 冗長な装飾語が排除され、AIがパースしやすい箇条書き形式になっているか。
- 整合性: 3つのファイル間で情報の重複がないか。